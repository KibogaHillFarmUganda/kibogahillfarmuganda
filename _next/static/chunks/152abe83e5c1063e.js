(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,6085,e=>{"use strict";e.s(["Headers",()=>l,"Request",()=>r,"Response",()=>n,"default",()=>a,"fetch",()=>s]);var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g;let s=t.fetch,a=t.fetch.bind(t),l=t.Headers,r=t.Request,n=t.Response},11177,e=>{"use strict";e.s(["default",()=>i]);var t=e.i(43476),s=e.i(71645),a=e.i(53210);let l=["goats","cows","sheep","chicken","coffee","banana","trees"],r=["Stock","Labour","Animal Health Management","Crop Health Management","Workers Feeding","Motivation of Workers","Supervision Expenses","Farm Development","Farm Events Preparations","Other …"],n=e=>(Number(e)||0).toLocaleString("en-UG",{maximumFractionDigits:0}),d=e=>{let t=Number(e);return Number.isFinite(t)?t:0};function i(){let[e,i]=s.useState(""),[o,c]=s.useState(""),[m,u]=s.useState(!1),[x,p]=s.useState(null),[h,b]=s.useState(null),[g,y]=s.useState(null),[f,j]=s.useState([]),[N,v]=s.useState(""),[w,S]=s.useState(!1),[_,k]=s.useState(null),[C,q]=s.useState("dream"),[P,D]=s.useState([]),[O,R]=s.useState(!1),[U,A]=s.useState(null),[L,E]=s.useState(""),[I,T]=s.useState(""),[M,F]=s.useState(""),[K,B]=s.useState(""),[G,H]=s.useState(""),[Q,X]=s.useState(null),[z,W]=s.useState([]),[Y,J]=s.useState(!1),[V,Z]=s.useState(null),[$,ee]=s.useState(""),[et,es]=s.useState(""),[ea,el]=s.useState(""),[er,en]=s.useState(""),[ed,ei]=s.useState(""),[eo,ec]=s.useState(null),[em,eu]=s.useState([]),[ex,ep]=s.useState(!1),[eh,eb]=s.useState(null),[eg,ey]=s.useState(""),[ef,ej]=s.useState(""),[eN,ev]=s.useState(""),[ew,eS]=s.useState(""),[e_,ek]=s.useState(""),[eC,eq]=s.useState(""),[eP,eD]=s.useState(""),[eO,eR]=s.useState(""),[eU,eA]=s.useState(""),eL=s.useMemo(()=>{let e=f.reduce((e,t)=>e+d(t.value),0),t=P.reduce((e,t)=>e+d(t.quantity),0),s=z.reduce((e,t)=>e+d(t.amount),0),a=e>0?Math.min(100,Math.round(t/e*100)):0;return{totaldreamed:e,totalProgress:t,totalExpenses:s,progressPct:a}},[f,P,z]);async function eE(e){ep(!0),eb(null);let{data:t,error:s}=await a.supabase.from("farming_sales").select("id,name,date,item,qty,rate,amount,purchased_by,picked_by,note,receipt_number,created_at").eq("name",e).order("date",{ascending:!1}).limit(200);if(s){eb("Sales table is missing in Supabase or not accessible."),eu([]),ep(!1);return}eu(null!=t?t:[]),ep(!1)}async function eI(t){if(t.preventDefault(),!e.trim())return;let s=ew.trim()?Number(ew.trim()):0,l=e_.trim()?Number(e_.trim()):0,r="__other__"===ef?eN.trim()||"Other item":ef.trim()||"Item",n={name:e.trim(),date:eg.trim()||new Date().toISOString().slice(0,10),item:r,qty:s,rate:l,amount:s*l,purchased_by:eC.trim()||null,picked_by:eP.trim()||null,note:eO.trim()||null,receipt_number:eU.trim()||null},{error:d}=await a.supabase.from("farming_sales").insert([n]);if(d)return void eb(d.message);ey(""),ej(""),ev(""),eS(""),ek(""),eq(""),eD(""),eR(""),eA(""),eE(e.trim())}async function eT(e){if(!window.confirm("Delete this sale?"))return;let{error:t}=await a.supabase.from("farming_sales").delete().eq("id",e);if(t)return void eb(t.message);eu(t=>t.filter(t=>t.id!==e))}function eM(){let e=new Blob(["Date,Item,Qty,Rate,Amount,PurchasedBy,PickedBy,ReceiptNumber,Note\n"+em.map(e=>{var t,s,a,l,r,n,d,i,o;return[null!=(t=e.date)?t:"",(null!=(s=e.item)?s:"").replace(/,/g," "),null!=(a=e.qty)?a:0,null!=(l=e.rate)?l:0,null!=(r=e.amount)?r:0,(null!=(n=e.purchased_by)?n:"").replace(/,/g," "),(null!=(d=e.picked_by)?d:"").replace(/,/g," "),null!=(i=e.receipt_number)?i:"",(null!=(o=e.note)?o:"").replace(/,/g," ")].join(",")}).join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="sales.csv",s.click(),URL.revokeObjectURL(t)}async function eF(t){var s;t.preventDefault(),u(!0),p(null),b(null),y(null),j([]),k(null),D([]),W([]),eu([]),X(null),ec(null);let r=e.trim(),n=o.trim(),{data:d,error:i}=await a.supabase.from("farming_targets").select("name,address,chosen_options,option_quantities,other_dream,created_at,passcode").ilike("name",r).order("created_at",{ascending:!1}).limit(1);if(i){p(i.message),u(!1);return}if(!d||0===d.length){p("No 5-year dream found for that name."),u(!1);return}let c=d[0];if(c.passcode&&c.passcode!==n){p("Passcode is wrong. Ask admin if you forgot it."),u(!1);return}let m=function(e){if(!e)return null;let t=e.trim();if(!t.startsWith("{"))return null;try{let e=JSON.parse(t);if(e&&"object"==typeof e&&"snapshot"in e)return e.snapshot;return null}catch(e){return null}}(c.other_dream)||{chosen_options:c.chosen_options,option_quantities:c.option_quantities,other_dream:c.other_dream,address:c.address,created_at:c.created_at},x=function(e){let t=[],s=e.chosen_options||[],a=e.option_quantities||{};return l.forEach(e=>{let l=s.includes(e),r=a[e];(l||"string"==typeof r&&""!==r)&&t.push({key:e,label:e.charAt(0).toUpperCase()+e.slice(1),value:null!=r?r:"",isOther:!1})}),Object.entries(a).forEach(e=>{let[s,a]=e;if(s.startsWith("other:")){let e=s.replace("other:","").trim()||"Other item";t.push({key:s,label:e,value:a,isOther:!0})}}),t}(c);b(c),y(m),j(x),v(null!=(s=c.address)?s:""),u(!1),eK(r),eH(r),eE(r)}async function eK(e){R(!0),A(null);let{data:t,error:s}=await a.supabase.from("farming_progress").select("id,name,item,quantity,date,notes,created_at").eq("name",e).order("date",{ascending:!1}).limit(100);if(s){A("Progress table is missing in Supabase or not accessible."),D([]),R(!1);return}D((null!=t?t:[]).map((e,t)=>{var s;return{id:null!=(s=e.id)?s:t,name:e.name,item:e.item,quantity:e.quantity,date:e.date,notes:e.notes,created_at:e.created_at}})),R(!1)}async function eB(t){if(t.preventDefault(),!e.trim())return;let s="__other__"===L?I.trim()||"Other item":L.trim()||"Unnamed item",l={name:e.trim(),item:s,quantity:M.trim()?Number(M.trim()):null,date:K.trim()||new Date().toISOString().slice(0,10),notes:G.trim()||null};if(null!==Q){let{error:e}=await a.supabase.from("farming_progress").update(l).eq("id",Q);if(e)return void A(e.message)}else{let{error:e}=await a.supabase.from("farming_progress").insert([l]);if(e)return void A(e.message)}E(""),T(""),F(""),B(""),H(""),X(null),eK(e.trim())}async function eG(e){if(!window.confirm("Delete this progress record?"))return;let{error:t}=await a.supabase.from("farming_progress").delete().eq("id",e);if(t)return void A(t.message);D(t=>t.filter(t=>t.id!==e))}async function eH(e){J(!0),Z(null);let{data:t,error:s}=await a.supabase.from("farming_expenses").select("id,name,item,amount,date,notes,created_at").eq("name",e).order("date",{ascending:!1}).limit(100);if(s){Z("Expenses table is missing in Supabase or not accessible."),W([]),J(!1);return}W((null!=t?t:[]).map((e,t)=>{var s;return{id:null!=(s=e.id)?s:t,name:e.name,item:e.item,amount:e.amount,date:e.date,notes:e.notes,created_at:e.created_at}})),J(!1)}async function eQ(t){if(t.preventDefault(),!e.trim())return;let s="Other …"===$?et.trim()||"Other expense":$.trim()||"Farm expense",l={name:e.trim(),item:s,amount:ea.trim()?Number(ea.trim()):null,date:er.trim()||new Date().toISOString().slice(0,10),notes:ed.trim()||null};if(null!==eo){let{error:e}=await a.supabase.from("farming_expenses").update(l).eq("id",eo);if(e)return void Z(e.message)}else{let{error:e}=await a.supabase.from("farming_expenses").insert([l]);if(e)return void Z(e.message)}ee(""),es(""),el(""),en(""),ei(""),ec(null),eH(e.trim())}async function eX(e){if(!window.confirm("Delete this expense?"))return;let{error:t}=await a.supabase.from("farming_expenses").delete().eq("id",e);if(t)return void Z(t.message);W(t=>t.filter(t=>t.id!==e))}return(0,t.jsx)("main",{className:"min-h-screen bg-slate-50",children:(0,t.jsxs)("div",{className:"max-w-3xl mx-auto py-10 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold text-slate-900",children:"My Farm Records"}),(0,t.jsx)("a",{href:"".concat("/kibogahillfarmuganda","/family/tracker"),className:"text-sm text-emerald-700 hover:underline",children:"← Back to family tracker"})]}),(0,t.jsxs)("div",{className:"flex gap-3 flex-wrap",children:[(0,t.jsx)("button",{onClick:()=>q("dream"),className:"px-4 py-2 rounded-full text-sm font-medium ".concat("dream"===C?"bg-emerald-500 text-white":"bg-white border border-emerald-100 text-emerald-700"),children:"Dream"}),(0,t.jsx)("button",{onClick:()=>q("progress"),className:"px-4 py-2 rounded-full text-sm font-medium ".concat("progress"===C?"bg-emerald-500 text-white":"bg-white border border-emerald-100 text-emerald-700"),children:"Progress"}),(0,t.jsx)("button",{onClick:()=>q("sales"),className:"px-4 py-2 rounded-full text-sm font-medium ".concat("sales"===C?"bg-emerald-500 text-white":"bg-white border border-emerald-100 text-emerald-700"),children:"Sales"}),(0,t.jsx)("button",{onClick:()=>q("expenses"),className:"px-4 py-2 rounded-full text-sm font-medium ".concat("expenses"===C?"bg-emerald-500 text-white":"bg-white border border-emerald-100 text-emerald-700"),children:"Expenses"}),(0,t.jsx)("button",{onClick:()=>q("performance"),className:"px-4 py-2 rounded-full text-sm font-medium ".concat("performance"===C?"bg-emerald-500 text-white":"bg-white border border-emerald-100 text-emerald-700"),children:"Performance"})]}),(0,t.jsxs)("form",{onSubmit:eF,className:"bg-white rounded-2xl border p-6 space-y-4 shadow-sm",children:[(0,t.jsxs)("p",{className:"text-sm text-slate-600",children:["Enter the ",(0,t.jsx)("b",{children:"same name"})," you used when saving and the ",(0,t.jsx)("b",{children:"passcode/PIN"})," you created."]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Name in register"}),(0,t.jsx)("input",{value:e,onChange:e=>i(e.target.value),required:!0,className:"w-full rounded-lg border border-slate-200 px-3 py-2",placeholder:"e.g. Kalema Abubakar"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Passcode / PIN"}),(0,t.jsx)("input",{value:o,onChange:e=>c(e.target.value),required:!0,type:"password",className:"w-full rounded-lg border border-slate-200 px-3 py-2",placeholder:"e.g. 2025@KHF"})]})]}),(0,t.jsx)("button",{type:"submit",disabled:m,className:"px-5 py-2 rounded-md bg-emerald-500 text-white text-sm font-medium hover:bg-emerald-600 disabled:opacity-60",children:m?"Loading...":({dream:"Show my Dream",progress:"Show my Progress",sales:"Show my Sales",expenses:"Show my Expenses",performance:"Show my Performance"})[C]}),x&&(0,t.jsx)("p",{className:"text-sm text-red-600 bg-red-50 border border-red-100 rounded-md px-3 py-2",children:x})]}),"dream"===C&&(0,t.jsxs)("div",{className:"space-y-4",children:[function(){var e;let s=Object.entries(null!=(e=null==g?void 0:g.option_quantities)?e:{});return(0,t.jsxs)("div",{className:"bg-white rounded-2xl border p-6 shadow-sm space-y-3",children:[(0,t.jsx)("h2",{className:"text-sm font-semibold text-slate-900",children:"Original dream (snapshot)"}),0===s.length?(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"No snapshot found for this record."}):(0,t.jsxs)("table",{className:"min-w-full text-xs",children:[(0,t.jsx)("thead",{className:"bg-slate-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Item"}),(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"dreamed"})]})}),(0,t.jsx)("tbody",{children:s.map(e=>{let[s,a]=e,l=s.startsWith("other:")?s.replace("other:","").trim()||"Other item":s.charAt(0).toUpperCase()+s.slice(1);return(0,t.jsxs)("tr",{className:"border-t",children:[(0,t.jsx)("td",{className:"px-3 py-2",children:l}),(0,t.jsx)("td",{className:"px-3 py-2",children:String(null!=a?a:"")})]},s)})})]})]})}(),(0,t.jsxs)("div",{className:"bg-white rounded-2xl border p-6 shadow-sm space-y-3",children:[(0,t.jsx)("h2",{className:"text-sm font-semibold text-slate-900",children:"Edit current dream"}),0===f.length?(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"No dream items to edit."}):(0,t.jsx)("div",{className:"grid gap-3 md:grid-cols-2",children:f.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("label",{className:"w-32 text-xs text-slate-600",children:e.label}),(0,t.jsx)("input",{type:"number",min:0,value:e.value,onChange:e=>{var t;return t=e.target.value,void j(e=>e.map((e,a)=>a===s?{...e,value:t}:e))},className:"flex-1 rounded-lg border border-slate-200 px-3 py-2 text-sm"})]},e.key))})]})]}),"progress"===C&&function(){let e=f.map(e=>e.label);return(0,t.jsxs)("div",{className:"bg-white rounded-2xl border p-6 shadow-sm space-y-4",children:[(0,t.jsx)("h2",{className:"text-sm font-semibold text-slate-900",children:"Progress / daily additions"}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"Record animals/crops you actually acquired — this will help compare with the dream."}),(0,t.jsxs)("form",{onSubmit:eB,className:"grid gap-3 md:grid-cols-4",children:[(0,t.jsxs)("div",{className:"md:col-span-1",children:[(0,t.jsxs)("select",{value:L,onChange:e=>E(e.target.value),className:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm bg-white",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Select item …"}),e.map(e=>(0,t.jsx)("option",{value:e,children:e},e)),(0,t.jsx)("option",{value:"__other__",children:"Other …"})]}),"__other__"===L&&(0,t.jsx)("input",{className:"mt-2 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm",placeholder:"Type item name",value:I,onChange:e=>T(e.target.value)})]}),(0,t.jsx)("input",{value:M,onChange:e=>F(e.target.value),className:"rounded-lg border border-slate-200 px-3 py-2 text-sm",placeholder:"Qty",type:"number",min:0,required:!0}),(0,t.jsx)("input",{value:K,onChange:e=>B(e.target.value),className:"rounded-lg border border-slate-200 px-3 py-2 text-sm",type:"date"}),(0,t.jsx)("input",{value:G,onChange:e=>H(e.target.value),className:"rounded-lg border border-slate-200 px-3 py-2 text-sm md:col-span-4",placeholder:"Notes e.g. bought from Kiboga market"}),(0,t.jsx)("button",{type:"submit",className:"px-4 py-2 rounded-md bg-emerald-500 text-white text-sm font-medium md:col-span-1",children:Q?"Update progress":"Add progress"})]}),U&&(0,t.jsx)("p",{className:"text-sm text-red-600 bg-red-50 border border-red-100 rounded-md px-3 py-2",children:U}),(0,t.jsx)("div",{className:"max-h-64 overflow-auto border rounded-lg",children:(0,t.jsxs)("table",{className:"min-w-full text-xs",children:[(0,t.jsx)("thead",{className:"bg-slate-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Date"}),(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Item"}),(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Quantity"}),(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Notes"}),(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Actions"})]})}),(0,t.jsx)("tbody",{children:O?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"px-3 py-3 text-center text-slate-400",children:"Loading progress …"})}):0===P.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"px-3 py-3 text-center text-slate-400",children:"No progress records yet."})}):P.map(e=>{var s,a,l;return(0,t.jsxs)("tr",{className:"border-t",children:[(0,t.jsx)("td",{className:"px-3 py-2",children:e.date?new Date(e.date).toLocaleDateString():"—"}),(0,t.jsx)("td",{className:"px-3 py-2",children:null!=(s=e.item)?s:"—"}),(0,t.jsx)("td",{className:"px-3 py-2",children:null!=(a=e.quantity)?a:"—"}),(0,t.jsx)("td",{className:"px-3 py-2",children:null!=(l=e.notes)?l:"—"}),(0,t.jsxs)("td",{className:"px-3 py-2 space-x-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>(function(e){var t,s,a;if(X(e.id),f.some(t=>{var s;return t.label.toLowerCase()===(null!=(s=e.item)?s:"").toLowerCase()})){let t=f.find(t=>{var s;return t.label.toLowerCase()===(null!=(s=e.item)?s:"").toLowerCase()});E(t?t.label:""),T("")}else E("__other__"),T(null!=(t=e.item)?t:"");F(null!=e.quantity?String(e.quantity):""),B(null!=(s=e.date)?s:""),H(null!=(a=e.notes)?a:""),q("progress")})(e),className:"text-emerald-700 hover:underline",children:"Edit"}),(0,t.jsx)("button",{type:"button",onClick:()=>eG(e.id),className:"text-red-600 hover:underline",children:"Delete"})]})]},e.id)})})]})})]})}(),"sales"===C&&function(){let s=Number(ew||0)*Number(e_||0)||0;return(0,t.jsxs)("div",{className:"bg-white rounded-2xl border p-6 shadow-sm space-y-4",children:[(0,t.jsx)("h2",{className:"text-sm font-semibold text-slate-900",children:"Sales"}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"Record sales: item, quantity, rate, purchased by, picked by. You can print a buyer receipt."}),(0,t.jsxs)("form",{onSubmit:eI,className:"grid gap-3 md:grid-cols-6",children:[(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-xs text-slate-600 mb-1",children:"Date"}),(0,t.jsx)("input",{value:eg,onChange:e=>ey(e.target.value),className:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm",type:"date"})]}),(0,t.jsxs)("div",{className:"md:col-span-4",children:[(0,t.jsx)("label",{className:"block text-xs text-slate-600 mb-1",children:"Item"}),(0,t.jsxs)("select",{value:ef,onChange:e=>ej(e.target.value),className:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm bg-white",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Select item …"}),f.map(e=>(0,t.jsx)("option",{value:e.label,children:e.label},e.key)),(0,t.jsx)("option",{value:"__other__",children:"Other …"})]}),"__other__"===ef&&(0,t.jsx)("input",{className:"mt-2 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm",placeholder:"Type other item (e.g., Manure)",value:eN,onChange:e=>ev(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-slate-600 mb-1",children:"Qty"}),(0,t.jsx)("input",{value:ew,onChange:e=>eS(e.target.value),className:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm",type:"number",min:0,required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-slate-600 mb-1",children:"Rate (UGX)"}),(0,t.jsx)("input",{value:e_,onChange:e=>ek(e.target.value),className:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm",type:"number",min:0,required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-slate-600 mb-1",children:"Amount (UGX)"}),(0,t.jsx)("input",{readOnly:!0,value:s,className:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm bg-slate-50"})]}),(0,t.jsxs)("div",{className:"md:col-span-3",children:[(0,t.jsx)("label",{className:"block text-xs text-slate-600 mb-1",children:"Purchased by"}),(0,t.jsx)("input",{value:eC,onChange:e=>eq(e.target.value),className:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm",placeholder:"Buyer name / org"})]}),(0,t.jsxs)("div",{className:"md:col-span-3",children:[(0,t.jsx)("label",{className:"block text-xs text-slate-600 mb-1",children:"Picked by"}),(0,t.jsx)("input",{value:eP,onChange:e=>eD(e.target.value),className:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm",placeholder:"Person who picked the item"})]}),(0,t.jsxs)("div",{className:"md:col-span-3",children:[(0,t.jsx)("label",{className:"block text-xs text-slate-600 mb-1",children:"Receipt number (optional)"}),(0,t.jsx)("input",{value:eU,onChange:e=>eA(e.target.value),className:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm",placeholder:"KHF-2025-0001"})]}),(0,t.jsxs)("div",{className:"md:col-span-6",children:[(0,t.jsx)("label",{className:"block text-xs text-slate-600 mb-1",children:"Note (optional)"}),(0,t.jsx)("input",{value:eO,onChange:e=>eR(e.target.value),className:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm",placeholder:"buyer phone, payment method, etc."})]}),(0,t.jsx)("button",{type:"submit",className:"px-4 py-2 rounded-md bg-emerald-500 text-white text-sm font-medium md:col-span-2",children:"Add sale"}),(0,t.jsx)("button",{type:"button",onClick:eM,className:"px-4 py-2 rounded-md border text-sm md:col-span-2",children:"Export CSV"})]}),eh&&(0,t.jsx)("p",{className:"text-sm text-red-600 bg-red-50 border border-red-100 rounded-md px-3 py-2",children:eh}),(0,t.jsx)("div",{className:"max-h-64 overflow-auto border rounded-lg",children:(0,t.jsxs)("table",{className:"min-w-full text-xs",children:[(0,t.jsx)("thead",{className:"bg-slate-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Date"}),(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Item"}),(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Purchased by"}),(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Picked by"}),(0,t.jsx)("th",{className:"text-right px-3 py-2",children:"Qty"}),(0,t.jsx)("th",{className:"text-right px-3 py-2",children:"Rate"}),(0,t.jsx)("th",{className:"text-right px-3 py-2",children:"Amount"}),(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Receipt"}),(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Actions"})]})}),(0,t.jsxs)("tbody",{children:[ex?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:9,className:"px-3 py-3 text-center text-slate-400",children:"Loading sales …"})}):0===em.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:9,className:"px-3 py-3 text-center text-slate-400",children:"No sales recorded yet."})}):em.map(s=>{var a,l,r,d,i,o,c,m,u;return(0,t.jsxs)("tr",{className:"border-t",children:[(0,t.jsx)("td",{className:"px-3 py-2",children:null!=(a=s.date)?a:"—"}),(0,t.jsx)("td",{className:"px-3 py-2 max-w-[260px] truncate",title:null!=(l=s.item)?l:"",children:null!=(r=s.item)?r:"—"}),(0,t.jsx)("td",{className:"px-3 py-2 max-w-[200px] truncate",title:null!=(d=s.purchased_by)?d:"",children:null!=(i=s.purchased_by)?i:"—"}),(0,t.jsx)("td",{className:"px-3 py-2 max-w-[200px] truncate",title:null!=(o=s.picked_by)?o:"",children:null!=(c=s.picked_by)?c:"—"}),(0,t.jsx)("td",{className:"px-3 py-2 text-right",children:null!=(m=s.qty)?m:"—"}),(0,t.jsx)("td",{className:"px-3 py-2 text-right",children:n(Number(s.rate||0))}),(0,t.jsx)("td",{className:"px-3 py-2 text-right font-medium",children:n(Number(s.amount||0))}),(0,t.jsx)("td",{className:"px-3 py-2",children:null!=(u=s.receipt_number)?u:"—"}),(0,t.jsxs)("td",{className:"px-3 py-2 space-x-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>(function(e,t){var s,a,l,r,d,i;let o=((null==(s=e.receipt_number)?void 0:s.trim())||"TEMP-".concat(String(e.id).slice(0,6))).toUpperCase(),c='<!DOCTYPE html><html><head><meta charset="utf-8" />\n  <title>Receipt '.concat(o,'</title>\n  <style>\n    body{font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;padding:24px;color:#111827}\n    .wrap{max-width:720px;margin:0 auto}\n    .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}\n    .brand{font-weight:800;font-size:20px;color:#065f46}\n    .muted{color:#6b7280;font-size:12px}\n    h1{font-size:22px;margin:8px 0 12px}\n    table{width:100%;border-collapse:collapse;margin-top:12px}\n    th,td{padding:10px;border-bottom:1px solid #e5e7eb;text-align:left}\n    tfoot td{font-weight:700}\n    .right{text-align:right}\n    .foot{margin-top:18px;font-size:12px;color:#6b7280}\n    @media print { button{display:none} body{padding:0} .wrap{margin:0} }\n  </style></head><body>\n  <div class="wrap">\n    <div class="head">\n      <div>\n        <div class="brand">Kiboga Hill Farm Uganda</div>\n        <div class="muted">Kiboga — Uganda • info@kibogahillfarmuganda.co.ug</div>\n      </div>\n      <div style="text-align:right">\n        <div class="muted">RECEIPT NO.</div>\n        <div style="font-weight:800;font-size:18px">').concat(o,'</div>\n        <div class="muted">Date: ').concat(null!=(a=e.date)?a:"",'</div>\n      </div>\n    </div>\n\n    <h1>Sales Receipt</h1>\n\n    <table>\n      <tbody>\n        <tr><td style="width:180px">Purchased by</td><td>').concat(null!=(l=e.purchased_by)?l:"-","</td></tr>\n        <tr><td>Picked by</td><td>").concat(null!=(r=e.picked_by)?r:"-","</td></tr>\n        <tr><td>Item</td><td>").concat(null!=(d=e.item)?d:"-",'</td></tr>\n      </tbody>\n    </table>\n\n    <table>\n      <thead><tr><th>Qty</th><th class="right">Rate (UGX)</th><th class="right">Amount (UGX)</th></tr></thead>\n      <tbody><tr>\n        <td>').concat(null!=(i=e.qty)?i:0,'</td>\n        <td class="right">').concat(n(Number(e.rate||0)),'</td>\n        <td class="right">').concat(n(Number(e.amount||0)),'</td>\n      </tr></tbody>\n      <tfoot><tr>\n        <td colspan="2" class="right">Total</td>\n        <td class="right">').concat(n(Number(e.amount||0)),"</td>\n      </tr></tfoot>\n    </table>\n\n    ").concat(e.note?'<div style="margin-top:8px"><strong>Note:</strong> '.concat(e.note,"</div>"):"",'\n\n    <div class="foot">Issued by: ').concat(t,'</div>\n    <div style="margin-top:18px"><button onclick="window.print()">Print</button></div>\n  </div>\n  <script>setTimeout(()=>window.print(),150)</script>\n  </body></html>'),m=window.open("","_blank","width=840,height=980");m&&(m.document.open(),m.document.write(c),m.document.close(),m.focus())})(s,e||""),className:"text-slate-700 hover:underline",children:"Print receipt"}),(0,t.jsx)("button",{type:"button",onClick:()=>eT(s.id),className:"text-red-600 hover:underline",children:"Delete"})]})]},s.id)}),em.length>0&&(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{colSpan:6,className:"px-3 py-2 text-right font-semibold",children:"Total"}),(0,t.jsx)("td",{className:"px-3 py-2 text-right font-bold",children:n(em.reduce((e,t)=>e+d(t.amount),0))}),(0,t.jsx)("td",{colSpan:2})]})]})]})})]})}(),"expenses"===C&&(0,t.jsxs)("div",{className:"bg-white rounded-2xl border p-6 shadow-sm space-y-4",children:[(0,t.jsx)("h2",{className:"text-sm font-semibold text-slate-900",children:"Expenses"}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"Capture feeds, drugs, labour, transport and other farm costs."}),(0,t.jsxs)("form",{onSubmit:eQ,className:"grid gap-3 md:grid-cols-4",children:[(0,t.jsxs)("div",{className:"md:col-span-1",children:[(0,t.jsxs)("select",{value:$,onChange:e=>ee(e.target.value),className:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm bg-white",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Select expense …"}),r.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]}),"Other …"===$&&(0,t.jsx)("input",{value:et,onChange:e=>es(e.target.value),className:"mt-2 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm",placeholder:"Type other expense"})]}),(0,t.jsx)("input",{value:ea,onChange:e=>el(e.target.value),className:"rounded-lg border border-slate-200 px-3 py-2 text-sm",placeholder:"Amount",type:"number",min:0,required:!0}),(0,t.jsx)("input",{value:er,onChange:e=>en(e.target.value),className:"rounded-lg border border-slate-200 px-3 py-2 text-sm",type:"date"}),(0,t.jsx)("input",{value:ed,onChange:e=>ei(e.target.value),className:"rounded-lg border border-slate-200 px-3 py-2 text-sm md:col-span-4",placeholder:"Notes"}),(0,t.jsx)("button",{type:"submit",className:"px-4 py-2 rounded-md bg-emerald-500 text-white text-sm font-medium md:col-span-1",children:eo?"Update expense":"Add expense"})]}),V&&(0,t.jsx)("p",{className:"text-sm text-red-600 bg-red-50 border border-red-100 rounded-md px-3 py-2",children:V}),(0,t.jsx)("div",{className:"max-h-64 overflow-auto border rounded-lg",children:(0,t.jsxs)("table",{className:"min-w-full text-xs",children:[(0,t.jsx)("thead",{className:"bg-slate-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Date"}),(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Item"}),(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Amount"}),(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Notes"}),(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Actions"})]})}),(0,t.jsx)("tbody",{children:Y?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"px-3 py-3 text-center text-slate-400",children:"Loading expenses …"})}):0===z.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"px-3 py-3 text-center text-slate-400",children:"No expenses recorded yet."})}):z.map(e=>{var s,a;return(0,t.jsxs)("tr",{className:"border-t",children:[(0,t.jsx)("td",{className:"px-3 py-2",children:e.date?new Date(e.date).toLocaleDateString():"—"}),(0,t.jsx)("td",{className:"px-3 py-2",children:null!=(s=e.item)?s:"—"}),(0,t.jsx)("td",{className:"px-3 py-2",children:null!=e.amount?"UGX ".concat(e.amount):"—"}),(0,t.jsx)("td",{className:"px-3 py-2",children:null!=(a=e.notes)?a:"—"}),(0,t.jsxs)("td",{className:"px-3 py-2 space-x-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>(function(e){var t,s,a;ec(e.id);let l=null!=(t=e.item)?t:"",n=r.find(e=>e.toLowerCase()===l.toLowerCase());n?(ee(n),es("")):(ee("Other …"),es(l)),el(null!=e.amount?String(e.amount):""),en(null!=(s=e.date)?s:""),ei(null!=(a=e.notes)?a:""),q("expenses")})(e),className:"text-emerald-700 hover:underline",children:"Edit"}),(0,t.jsx)("button",{type:"button",onClick:()=>eX(e.id),className:"text-red-600 hover:underline",children:"Delete"})]})]},e.id)})})]})})]}),"performance"===C&&function(){let{totaldreamed:e,totalProgress:s,totalExpenses:a,progressPct:l}=eL;return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,t.jsxs)("div",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"dreamed total (all items)"}),(0,t.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:e})]}),(0,t.jsxs)("div",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"Actual progress (all items)"}),(0,t.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:s})]}),(0,t.jsxs)("div",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"Expenses (UGX)"}),(0,t.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:a.toLocaleString()})]})]}),(0,t.jsxs)("div",{className:"bg-white border rounded-2xl p-6 shadow-sm space-y-3",children:[(0,t.jsx)("h2",{className:"text-sm font-semibold text-slate-900",children:"Performance"}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"Simple completion level = actual progress ÷ dreamed."}),(0,t.jsx)("div",{className:"w-full h-3 rounded-full bg-slate-100 overflow-hidden",children:(0,t.jsx)("div",{className:"h-3 bg-emerald-500 transition-all",style:{width:"".concat(l,"%")}})}),(0,t.jsxs)("p",{className:"text-xs text-slate-500",children:[l,"% of your total target has been reached (rough estimate)."]}),(0,t.jsx)("div",{className:"grid gap-2 md:grid-cols-2",children:f.map(e=>{let s=d(e.value),a=P.filter(t=>{var s;return(null!=(s=t.item)?s:"").toLowerCase()===e.label.toLowerCase()}).reduce((e,t)=>e+d(t.quantity),0),l=s>0?Math.min(100,Math.round(a/s*100)):0;return(0,t.jsxs)("div",{className:"border rounded-lg px-3 py-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:e.label}),(0,t.jsxs)("span",{className:"text-xs text-slate-500",children:[a,"/",s]})]}),(0,t.jsx)("div",{className:"w-full h-2 bg-slate-100 rounded-full mt-2 overflow-hidden",children:(0,t.jsx)("div",{className:"h-2 bg-emerald-400",style:{width:"".concat(l,"%")}})})]},e.key)})})]})]})}()]})})}},11737,e=>{e.v(e=>Promise.resolve().then(()=>e(6085)))}]);