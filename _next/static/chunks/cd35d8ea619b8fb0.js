(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,6085,e=>{"use strict";e.s(["Headers",()=>r,"Request",()=>l,"Response",()=>o,"default",()=>s,"fetch",()=>a]);var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g;let a=t.fetch,s=t.fetch.bind(t),r=t.Headers,l=t.Request,o=t.Response},74382,e=>{"use strict";e.s(["default",()=>i]);var t=e.i(43476),a=e.i(71645),s=e.i(22016),r=e.i(53210);let l=[{id:"october-enterprise",title:"Family Voting — October Enterprise",subtitle:"Vote once. Registered members only.",supabaseTable:"family_votes",options:[{id:"goats",label:"Goats"},{id:"cows",label:"Cows"},{id:"chicken",label:"Chicken"},{id:"sheep",label:"Sheep"}]},{id:"farming-target-5yr",title:"My 5-year Dream",subtitle:"Choose what you want to achieve in 5 years.",supabaseTable:"farming_targets",options:[{id:"goats",label:"Goats"},{id:"cows",label:"Cows"},{id:"sheep",label:"Sheep"},{id:"chicken",label:"Chicken"},{id:"coffee",label:"Coffee"},{id:"banana",label:"Banana"},{id:"trees",label:"Trees"},{id:"other",label:"My other options"}]}],o={goats:"How many goats? e.g. 500",cows:"How many cows? e.g. 100",sheep:"How many sheep? e.g. 100",chicken:"How many birds? e.g. 1000",coffee:"How many acres of coffee? e.g. 10",banana:"How many acres of banana? e.g. 5",trees:"How many acres of trees? e.g. 3",other:"Other options"};function n(e){let{config:l,allowedMembers:n,loadingMembers:i}=e,[d,c]=a.useState("choose"),m="farming-target-5yr"===l.id,[u,p]=a.useState(null),[h,x]=a.useState([]),[b,f]=a.useState({}),[g,y]=a.useState([]),[v,j]=a.useState(""),[N,w]=a.useState(""),[k,C]=a.useState(""),[S,_]=a.useState(""),[q,T]=a.useState(!1),[E,H]=a.useState(""),[A,P]=a.useState(null),[R,F]=a.useState(""),[Y,B]=a.useState(""),[D,K]=a.useState(""),[O,V]=a.useState(!1),[I,L]=a.useState([]),M="khf-poll-".concat(l.id,"-voted");function G(e){if(m)x(t=>{if(t.includes(e)){let a=t.filter(t=>t!==e);return f(t=>{let a={...t};return delete a[e],a}),"other"===e&&(y([]),j(""),w("")),a}return[...t,e]});else p(e),c("name")}function U(){v.trim()&&N.trim()&&(y(e=>[...e,{label:v.trim(),quantity:N.trim()}]),j(""),w(""))}async function W(e){if(e.preventDefault(),i){H("Family register is still loading. Try again."),c("blocked");return}if(!n.length){H("Family register is empty. Ask admin to add members."),c("blocked");return}let t=k.trim();if(!n.some(e=>e.toLowerCase().trim()===t.toLowerCase())){H("Name not found in Supabase family_members. Contact Secretary."),c("blocked");return}if(m){let{data:e,error:a}=await r.supabase.from("farming_targets").select("id, name, passcode, chosen_options, option_quantities, other_plan, option, created_at").or("name.eq.".concat(t,",name.ilike.").concat(t,",name.ilike.").concat(t,"%")).order("created_at",{ascending:!1}).limit(1);if(!a&&e&&e.length>0){let t=e[0];V(!0);let a=[];if(Array.isArray(t.chosen_options)&&t.chosen_options.length>0?a=t.chosen_options:t.option&&(a=[t.option]),x(a),L(a),t.option_quantities&&"object"==typeof t.option_quantities&&f(t.option_quantities),"string"==typeof t.other_plan&&t.other_plan.trim()){let e=t.other_plan.split(";").map(e=>e.trim()).filter(Boolean),s=[];e.forEach(e=>{let[t,a]=e.split("=");t&&s.push({label:t.trim(),quantity:(a||"").trim()})}),s.length>0&&(y(s),a.includes("other")||(x(e=>[...e,"other"]),L(e=>[...e,"other"])))}return t.passcode?(P(t.passcode),c("enter-pass"),void 0):void c("create-pass")}return V(!1),c("create-pass"),void 0}c("address")}async function Q(e){e.preventDefault();let t=k.trim();if(m){if(0===h.length){H("Pick at least one dream target."),c("blocked");return}h.includes("other")&&(v.trim()||N.trim())&&y(e=>[...e,{label:v.trim()||"Other",quantity:N.trim()||"1"}])}else if(!u)return;if(T(!0),m){let e={};h.forEach(t=>{"other"!==t&&(e[t]=b[t]||"")}),g.forEach(t=>{e["other:".concat(t.label)]=t.quantity});let a=null!=A?A:R.trim().length>0?R.trim():null,s={name:t,address:S,option:"multiple",chosen_options:h,option_quantities:e,other_plan:g.length>0?g.map(e=>"".concat(e.label,"=").concat(e.quantity)).join("; "):null,passcode:a};if(O){let{error:e}=await r.supabase.from(l.supabaseTable).update(s).eq("name",t);e?(console.error(e),H("Could not update your farming dream. Enter passcode or track your progress."),c("enter-pass")):c("done"),T(!1);return}let{error:o}=await r.supabase.from(l.supabaseTable).insert([s]);if(o){let e=o.message.toLowerCase();if(e.includes("duplicate key")||e.includes("unique")){let{error:e}=await r.supabase.from(l.supabaseTable).update(s).eq("name",t);if(!e){c("done"),T(!1);return}H("You already have a 5-year dream saved. Enter your passcode or go to Track my progress."),V(!0),c("enter-pass")}else console.error(o),H("Could not save your farming dream: ".concat(o.message)),c("blocked");T(!1);return}c("done"),T(!1);return}let{error:a}=await r.supabase.from(l.supabaseTable).insert([{name:t,address:S,option:u}]);a?(console.error(a),a.message&&a.message.toLowerCase().includes("duplicate key")?H("You have already voted in this poll."):H("Could not save vote. ".concat(a.message)),c("blocked")):(localStorage.setItem(M,"yes"),c("done")),T(!1)}return a.useEffect(()=>{m||"yes"===localStorage.getItem(M)&&c("done")},[M,m]),(0,t.jsx)("section",{className:"w-full",children:(0,t.jsxs)("div",{className:"rounded-2xl bg-white shadow-sm border border-emerald-50 p-5 mb-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-slate-900 mb-1",children:l.title}),l.subtitle?(0,t.jsx)("p",{className:"text-sm text-slate-600 mb-4",children:l.subtitle}):null,"choose"===d&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"grid gap-3 md:grid-cols-3",children:l.options.map(e=>{let a=m?h.includes(e.id):u===e.id;if(m){var s;let r="other"===e.id;return(0,t.jsxs)("label",{className:"flex flex-col gap-2 rounded-xl border px-4 py-3 cursor-pointer transition ".concat(a?"border-emerald-500 bg-emerald-50":"border-emerald-200 bg-emerald-50/50 hover:bg-emerald-100"),children:[(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:a,onChange:()=>G(e.id),className:"mt-1 accent-emerald-600 w-4 h-4"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-base font-medium text-slate-900",children:e.label}),(0,t.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"Set your own quantity"})]})]}),!r&&a&&(0,t.jsx)("input",{value:null!=(s=b[e.id])?s:"",onChange:t=>{var a,s;return a=e.id,s=t.target.value,void f(e=>({...e,[a]:s}))},className:"mt-1 w-full rounded-lg border border-emerald-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400",placeholder:o[e.id]||"Enter your target number"}),r&&a&&(0,t.jsxs)("div",{className:"mt-1 space-y-2",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{value:v,onChange:e=>j(e.target.value),className:"flex-1 rounded-lg border border-emerald-200 px-2 py-1 text-sm",placeholder:"e.g. Fish, Pigs, Bees..."}),(0,t.jsx)("input",{value:N,onChange:e=>w(e.target.value),className:"w-28 rounded-lg border border-emerald-200 px-2 py-1 text-sm",placeholder:"Qty"}),(0,t.jsx)("button",{type:"button",onClick:U,className:"px-3 py-1 rounded-md bg-emerald-500 text-white text-sm",children:"Add"})]}),g.length>0&&(0,t.jsx)("ul",{className:"text-xs text-slate-700 space-y-1",children:g.map((e,a)=>(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-emerald-400 mt-1"}),(0,t.jsxs)("span",{children:[e.label," — ",e.quantity]})]},a))})]})]},e.id)}return(0,t.jsxs)("button",{onClick:()=>G(e.id),className:"rounded-xl border px-4 py-3 text-left transition ".concat(a?"border-emerald-500 bg-emerald-50":"border-emerald-200 bg-emerald-50/50 hover:bg-emerald-100"),children:[(0,t.jsx)("div",{className:"text-base font-medium text-slate-900",children:e.label}),(0,t.jsxs)("div",{className:"text-xs text-slate-500 mt-1",children:["Vote for ",e.label]})]},e.id)})}),m&&(0,t.jsxs)("div",{className:"mt-4 flex gap-3",children:[(0,t.jsx)("button",{onClick:()=>c("name"),className:"px-6 py-2 rounded-lg bg-emerald-500 text-white text-sm font-medium disabled:opacity-60",disabled:0===h.length,children:"Continue"}),(0,t.jsx)(s.default,{href:"/family/tracker/progress",className:"px-6 py-2 rounded-lg bg-white border border-emerald-200 text-emerald-700 text-sm font-medium hover:bg-emerald-50",children:"Track my progress"})]})]}),"name"===d&&(0,t.jsxs)("form",{onSubmit:W,className:"mt-3 space-y-3",children:[(0,t.jsx)("p",{className:"text-sm text-slate-600",children:"Enter your name as it appears in the Family register."}),(0,t.jsx)("input",{value:k,onChange:e=>C(e.target.value),required:!0,className:"w-full rounded-lg border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-400",placeholder:"e.g. Kalema Abubakar",list:"family-names"}),(0,t.jsx)("datalist",{id:"family-names",children:n.map(e=>(0,t.jsx)("option",{value:e},e))}),(0,t.jsx)("button",{type:"submit",className:"px-4 py-2 rounded-lg bg-emerald-500 text-white text-sm font-medium",children:"Continue"})]}),"create-pass"===d&&(0,t.jsxs)("form",{onSubmit:function(e){return(e.preventDefault(),!R.trim()||R.trim().length<4)?void alert("Passcode should be at least 4 characters."):R.trim()!==Y.trim()?void alert("Passcodes do not match."):void c("address")},className:"mt-3 space-y-3",children:[O&&(0,t.jsxs)("div",{className:"rounded-md bg-amber-50 border border-amber-100 px-3 py-2 text-xs text-amber-800",children:["You already have a 5-year plan saved. You can"," ",(0,t.jsx)(s.default,{href:"/family/tracker/progress",className:"underline",children:"track it here"})," ","or save a new version below."]}),(0,t.jsx)("p",{className:"text-sm text-slate-600",children:"Create a small password / PIN. You’ll use it later to edit or track."}),(0,t.jsx)("input",{value:R,onChange:e=>F(e.target.value),type:"password",required:!0,className:"w-full rounded-lg border border-slate-200 px-3 py-2",placeholder:"e.g. 2025@KHF"}),(0,t.jsx)("input",{value:Y,onChange:e=>B(e.target.value),type:"password",required:!0,className:"w-full rounded-lg border border-slate-200 px-3 py-2",placeholder:"Confirm passcode"}),(0,t.jsx)("button",{type:"submit",className:"px-4 py-2 rounded-lg bg-emerald-500 text-white text-sm font-medium",children:"Continue"})]}),"enter-pass"===d&&(0,t.jsxs)("form",{onSubmit:function(e){if(e.preventDefault(),!A){H("No passcode on record. Contact Admin."),c("blocked");return}if(D.trim()!==A.trim()){H("Wrong passcode."),c("blocked");return}c("address")},className:"mt-3 space-y-3",children:[(0,t.jsxs)("div",{className:"rounded-md bg-emerald-50 border border-emerald-100 px-3 py-2 text-xs text-emerald-900 space-y-2",children:[(0,t.jsxs)("p",{children:["We found an existing 5-year dream for ",(0,t.jsx)("b",{children:k}),". Enter your passcode to edit / save again — or"," ",(0,t.jsx)(s.default,{href:"/family/tracker/progress",className:"underline",children:"go to tracker"}),"."]}),I.length>0&&(0,t.jsx)("p",{className:"flex gap-1 flex-wrap",children:I.map(e=>(0,t.jsx)("span",{className:"inline-flex px-2 py-0.5 border rounded-full bg-white/70 text-xs",children:e},e))})]}),(0,t.jsx)("input",{value:D,onChange:e=>K(e.target.value),type:"password",required:!0,className:"w-full rounded-lg border border-slate-200 px-3 py-2",placeholder:"Enter your passcode"}),(0,t.jsx)("button",{type:"submit",className:"px-4 py-2 rounded-lg bg-emerald-500 text-white text-sm font-medium",children:"Continue"})]}),"address"===d&&(0,t.jsxs)("form",{onSubmit:Q,className:"mt-3 space-y-3",children:[(0,t.jsxs)("p",{className:"text-sm text-slate-600",children:["Hi ",(0,t.jsx)("strong",{children:k}),", add your current address or location."]}),(0,t.jsx)("input",{value:S,onChange:e=>_(e.target.value),required:!0,className:"w-full rounded-lg border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-400",placeholder:"e.g. Kikuubo, Bukomero T.C."}),(0,t.jsx)("button",{type:"submit",disabled:q,className:"px-4 py-2 rounded-lg bg-emerald-500 text-white text-sm font-medium disabled:opacity-60",children:q?"Saving...":"Submit"})]}),"done"===d&&(0,t.jsxs)("div",{className:"mt-4 rounded-lg bg-emerald-50 border border-emerald-100 px-4 py-3",children:[(0,t.jsx)("p",{className:"text-sm text-emerald-900 font-medium",children:"✅ Vote received. Thank you!"}),(0,t.jsx)("p",{className:"text-xs text-emerald-900/70 mt-1",children:"You can track or update any time."}),m&&(0,t.jsx)("p",{className:"mt-3",children:(0,t.jsx)(s.default,{href:"/family/tracker/progress",className:"inline-flex items-center gap-1 text-sm text-emerald-700 hover:underline",children:"➕ Track my Dream progress"})})]}),"blocked"===d&&(0,t.jsxs)("div",{className:"mt-4 rounded-lg bg-red-50 border border-red-100 px-4 py-3 space-y-2",children:[(0,t.jsx)("p",{className:"text-sm text-red-900 font-medium",children:"Vote blocked"}),(0,t.jsx)("p",{className:"text-xs text-red-900/60 mt-1",children:E}),m&&(0,t.jsx)("p",{className:"mt-2",children:(0,t.jsx)(s.default,{href:"/family/tracker/progress",className:"inline-flex items-center gap-1 text-sm text-red-900/80 underline",children:"Go to Track my progress"})})]})]})})}function i(){let[e,s]=a.useState([]),[o,i]=a.useState(!0);return a.useEffect(()=>{let e=!0;return async function(){i(!0);let{data:t,error:a}=await r.supabase.from("family_members").select("full_name").order("full_name",{ascending:!0});if(e){if(a)console.error("Could not fetch family_members:",a.message),s([]);else{var l;s(null!=(l=null==t?void 0:t.map(e=>e.full_name).filter(e=>!!e&&e.trim().length>0))?l:[])}i(!1)}}(),()=>{e=!1}},[]),(0,t.jsx)("div",{className:"space-y-6",children:l.map(a=>(0,t.jsx)(n,{config:a,allowedMembers:e,loadingMembers:o},a.id))})}},58043,e=>{"use strict";e.s(["default",()=>r]);var t=e.i(43476),a=e.i(74382),s=e.i(22016);function r(){return(0,t.jsxs)("main",{className:"container mx-auto py-10 space-y-6",children:[(0,t.jsx)(a.default,{}),(0,t.jsxs)("section",{className:"bg-white border rounded-2xl p-6 shadow-sm",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-slate-900 mb-1",children:"Track or edit what you already saved"}),(0,t.jsx)("p",{className:"text-sm text-slate-600 mb-4",children:"If you already filled the 5-year dream above, open your records here and update your quantities. You’ll need the passcode you created."}),(0,t.jsx)(s.default,{href:"/family/tracker/progress",className:"inline-flex items-center rounded-md bg-emerald-600 text-white px-5 py-2 text-sm font-medium hover:bg-emerald-700",children:"Access my Records"})]})]})}},11737,e=>{e.v(e=>Promise.resolve().then(()=>e(6085)))}]);