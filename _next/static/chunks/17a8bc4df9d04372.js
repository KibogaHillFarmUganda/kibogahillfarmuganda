(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,53594,e=>{"use strict";e.s(["Headers",()=>l,"Request",()=>r,"Response",()=>n,"default",()=>a,"fetch",()=>t]);var s="undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g;let t=s.fetch,a=s.fetch.bind(s),l=s.Headers,r=s.Request,n=s.Response},45582,e=>{"use strict";e.s(["default",()=>r]);var s=e.i(84250),t=e.i(92579),a=e.i(56922);let l={"200-goats":"200 Goats","50-cows":"50 Cows",restaurant:"Big Restaurant","10000-coffee":"10,000 Kgs of Coffee","10000-matooke":"10,000 Bunches of Matooke",other:"Other / My own numbers"};function r(){var e,r,n,c;let[d,i]=t.useState("poll"),[o,x]=t.useState("general"),[m,h]=t.useState([]),[p,g]=t.useState(!1),[j,y]=t.useState(""),[u,N]=t.useState([]),[b,f]=t.useState(!1),[v,w]=t.useState(""),[S,_]=t.useState([]),[R,k]=t.useState(!1),[C,L]=t.useState(""),[P,O]=t.useState([]),[A,D]=t.useState(!1),[T,M]=t.useState("");async function F(){g(!0),y("");let{data:e,error:s}=await a.supabase.from("family_members").select("*").order("created_at",{ascending:!1});s?(console.error(s),y(s.message),h([])):h(e||[]),g(!1)}async function U(){f(!0),w("");let{data:e,error:s}=await a.supabase.from("family_votes").select("*").order("created_at",{ascending:!1});s?(console.error(s),w(s.message),N([])):N(e||[]),f(!1)}async function B(){k(!0),L("");let{data:e,error:s}=await a.supabase.from("farming_targets").select("*").order("created_at",{ascending:!1});s?(console.error(s),L(s.message),_([])):_((e||[]).map(e=>({...e,chosen_options:Array.isArray(e.chosen_options)?e.chosen_options:e.chosen_options?[e.chosen_options]:[]}))),k(!1)}async function E(){D(!0),M("");let{data:e,error:s}=await a.supabase.from("farming_progress").select("*").order("created_at",{ascending:!1});s?(console.error(s),M(s.message),O([])):O(e||[]),D(!1)}t.useEffect(()=>{F(),U(),B(),E()},[]);let G=[];for(let e of u){let s=G.find(s=>s.option===e.option);s?s.count+=1:G.push({option:e.option,count:1})}let K=G.reduce((e,s)=>e+s.count,0),V={};S.forEach(e=>{Array.isArray(e.chosen_options)&&e.chosen_options.length>0?e.chosen_options.forEach(e=>{V[e]=(V[e]||0)+1}):e.option&&(V[e.option]=(V[e.option]||0)+1)});let H=Object.values(V).reduce((e,s)=>e+s,0);function q(e,s){if(!e.length)return;let t=Object.keys(e[0]),a=new Blob([[t.join(","),...e.map(e=>t.map(s=>{let t=e[s];return Array.isArray(t)?'"'.concat(t.join(";"),'"'):"string"==typeof t?'"'.concat(t.replace(/"/g,'""'),'"'):null!=t?t:""}).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(a),r=document.createElement("a");r.href=l,r.download=s,r.click(),URL.revokeObjectURL(l)}return(0,s.jsx)("main",{className:"min-h-screen bg-green-50",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Kiboga Hill Farm – Admin Panel"}),(0,s.jsx)("p",{className:"text-gray-500 mb-6",children:"Voting results (Supabase) + Family members."}),(0,s.jsxs)("div",{className:"inline-flex rounded-full bg-white shadow-sm mb-6 overflow-hidden",children:[(0,s.jsx)("button",{onClick:()=>i("poll"),className:"px-6 py-2 text-sm font-medium transition ".concat("poll"===d?"bg-green-100 text-green-900":"text-gray-700 hover:bg-gray-50"),children:"Poll results"}),(0,s.jsx)("button",{onClick:()=>i("members"),className:"px-6 py-2 text-sm font-medium transition ".concat("members"===d?"bg-green-100 text-green-900":"text-gray-700 hover:bg-gray-50"),children:"Family members"})]}),"poll"===d?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{className:"inline-flex gap-2 bg-slate-100 rounded-full p-1",children:[(0,s.jsx)("button",{onClick:()=>x("general"),className:"px-4 py-1.5 rounded-full text-sm ".concat("general"===o?"bg-white text-slate-900 shadow-sm":"text-slate-600"),children:"General Polls"}),(0,s.jsx)("button",{onClick:()=>x("target"),className:"px-4 py-1.5 rounded-full text-sm ".concat("target"===o?"bg-white text-slate-900 shadow-sm":"text-slate-600"),children:"5-year Dream"}),(0,s.jsx)("button",{onClick:()=>x("progress"),className:"px-4 py-1.5 rounded-full text-sm ".concat("progress"===o?"bg-white text-slate-900 shadow-sm":"text-slate-600"),children:"5-year Progress"})]}),"general"===o?(0,s.jsx)("button",{onClick:U,disabled:b,className:"border rounded-lg px-3 py-1.5 text-sm bg-white hover:bg-gray-50 disabled:opacity-60",children:b?"Refreshing...":"Refresh"}):"target"===o?(0,s.jsx)("button",{onClick:B,disabled:R,className:"border rounded-lg px-3 py-1.5 text-sm bg-white hover:bg-gray-50 disabled:opacity-60",children:R?"Refreshing...":"Refresh"}):(0,s.jsx)("button",{onClick:E,disabled:A,className:"border rounded-lg px-3 py-1.5 text-sm bg-white hover:bg-gray-50 disabled:opacity-60",children:A?"Refreshing...":"Refresh"})]}),"general"===o?(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 space-y-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Poll results — General"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,s.jsxs)("div",{className:"bg-emerald-50 rounded-xl px-4 py-3",children:[(0,s.jsx)("p",{className:"text-xs text-emerald-800/70",children:"Total enterprise votes"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-emerald-900",children:K})]}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-xl px-4 py-3",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Goats"}),(0,s.jsx)("p",{className:"text-lg font-semibold",children:(null==(e=G.find(e=>"goats"===e.option))?void 0:e.count)||0})]}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-xl px-4 py-3",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Cows"}),(0,s.jsx)("p",{className:"text-lg font-semibold",children:(null==(r=G.find(e=>"cows"===e.option))?void 0:r.count)||0})]}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-xl px-4 py-3",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Others"}),(0,s.jsx)("p",{className:"text-lg font-semibold",children:((null==(n=G.find(e=>"chicken"===e.option))?void 0:n.count)||0)+((null==(c=G.find(e=>"sheep"===e.option))?void 0:c.count)||0)})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[0===G.length&&!b&&(0,s.jsx)("p",{className:"text-gray-400 text-sm",children:"No votes to plot yet."}),G.map(e=>{let t=0===K?0:Math.round(e.count/K*100);return(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"capitalize",children:e.option}),(0,s.jsxs)("span",{className:"text-gray-500",children:[e.count," (",t,"%)"]})]}),(0,s.jsx)("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-emerald-500",style:{width:"".concat(t,"%")}})})]},e.option)})]}),(0,s.jsxs)("div",{className:"pt-4 border-t flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold",children:"Latest — General Poll votes"}),u.length>0&&(0,s.jsx)("button",{onClick:()=>q(u,"general-poll-votes.csv"),className:"text-xs px-3 py-1.5 bg-slate-100 rounded-md hover:bg-slate-200 flex items-center gap-1",children:"⬇️ Download CSV"})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-left text-gray-500",children:[(0,s.jsx)("th",{className:"py-2 pr-4",children:"Name"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"Address"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"Option"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"Time"})]})}),(0,s.jsxs)("tbody",{children:[u.slice(0,20).map(e=>(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsx)("td",{className:"py-1.5 pr-4",children:e.name}),(0,s.jsx)("td",{className:"py-1.5 pr-4",children:e.address||"—"}),(0,s.jsx)("td",{className:"py-1.5 pr-4 capitalize",children:e.option}),(0,s.jsx)("td",{className:"py-1.5 pr-4 text-xs text-gray-500",children:new Date(e.created_at).toLocaleString()})]},e.id)),0===u.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:4,className:"py-2 text-gray-400",children:"No votes yet."})})]})]})})]}):"target"===o?(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 space-y-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Poll — Individual 5-year Farming Dream"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:[(0,s.jsxs)("div",{className:"bg-emerald-50 rounded-xl px-4 py-3",children:[(0,s.jsx)("p",{className:"text-xs text-emerald-800/70",children:"Total target submissions"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-emerald-900",children:S.length})]}),Object.keys(l).map(e=>(0,s.jsxs)("div",{className:"bg-gray-50 rounded-xl px-4 py-3",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:l[e]}),(0,s.jsx)("p",{className:"text-lg font-semibold",children:V[e]||0})]},e))]}),(0,s.jsx)("div",{className:"space-y-3",children:Object.entries(l).map(e=>{let[t,a]=e,l=V[t]||0,r=0===H?0:Math.round(l/H*100);return(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{children:a}),(0,s.jsxs)("span",{className:"text-gray-500",children:[l," (",r,"%)"]})]}),(0,s.jsx)("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-emerald-500",style:{width:"".concat(r,"%")}})})]},t)})}),(0,s.jsxs)("div",{className:"pt-4 border-t flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold",children:"Latest — 5-year target votes"}),S.length>0&&(0,s.jsx)("button",{onClick:()=>q(S,"farming-targets-votes.csv"),className:"text-xs px-3 py-1.5 bg-slate-100 rounded-md hover:bg-slate-200 flex items-center gap-1",children:"⬇️ Download CSV"})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-left text-gray-500",children:[(0,s.jsx)("th",{className:"py-2 pr-4",children:"Name"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"Address"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"Options picked"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"Other plan"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"Time"})]})}),(0,s.jsxs)("tbody",{children:[S.slice(0,30).map(e=>{var t;let a=e.chosen_options&&e.chosen_options.length?e.chosen_options.map(e=>{var s;return null!=(s=l[e])?s:e}).join(", "):e.option?null!=(t=l[e.option])?t:e.option:"—";return(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsx)("td",{className:"py-1.5 pr-4",children:e.name}),(0,s.jsx)("td",{className:"py-1.5 pr-4",children:e.address||"—"}),(0,s.jsx)("td",{className:"py-1.5 pr-4",children:a}),(0,s.jsx)("td",{className:"py-1.5 pr-4",children:e.other_plan&&e.other_plan.trim().length>0?e.other_plan:"—"}),(0,s.jsx)("td",{className:"py-1.5 pr-4 text-xs text-gray-500",children:new Date(e.created_at).toLocaleString()})]},e.id)}),0===S.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:5,className:"py-2 text-gray-400",children:"No votes yet."})})]})]})})]}):(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 space-y-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"5-year Progress"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Monthly achievements submitted by members (table"," ",(0,s.jsx)("code",{children:"farming_progress"}),")."]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Total entries: ",(0,s.jsx)("strong",{children:P.length})]}),P.length>0&&(0,s.jsx)("button",{onClick:()=>q(P,"farming-progress.csv"),className:"text-xs px-3 py-1.5 bg-slate-100 rounded-md hover:bg-slate-200 flex items-center gap-1",children:"⬇️ Download CSV"})]}),(0,s.jsx)("div",{className:"overflow-x-auto rounded-lg border",children:(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{className:"text-left text-gray-500",children:[(0,s.jsx)("th",{className:"py-2 px-3",children:"Name"}),(0,s.jsx)("th",{className:"py-2 px-3",children:"Month"}),(0,s.jsx)("th",{className:"py-2 px-3",children:"Year"}),(0,s.jsx)("th",{className:"py-2 px-3",children:"Item"}),(0,s.jsx)("th",{className:"py-2 px-3",children:"Achieved"}),(0,s.jsx)("th",{className:"py-2 px-3",children:"Note"}),(0,s.jsx)("th",{className:"py-2 px-3",children:"Time"})]})}),(0,s.jsx)("tbody",{children:T?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,className:"py-3 px-3 text-red-500",children:T})}):A?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,className:"py-3 px-3 text-gray-500",children:"Loading..."})}):0===P.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,className:"py-3 px-3 text-gray-400",children:"No progress entries yet."})}):P.map(e=>{var t;return(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsx)("td",{className:"py-2 px-3",children:e.name}),(0,s.jsx)("td",{className:"py-2 px-3",children:e.month?e.month:"—"}),(0,s.jsx)("td",{className:"py-2 px-3",children:e.year?e.year:"—"}),(0,s.jsx)("td",{className:"py-2 px-3",children:e.item?null!=(t=l[e.item])?t:e.item:"—"}),(0,s.jsx)("td",{className:"py-2 px-3",children:null!=e.achieved?e.achieved:"—"}),(0,s.jsx)("td",{className:"py-2 px-3",children:e.note&&e.note.trim().length?e.note:"—"}),(0,s.jsx)("td",{className:"py-2 px-3 text-xs text-gray-500",children:new Date(e.created_at).toLocaleString()})]},e.id)})})]})})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h2",{className:"text-lg font-semibold",children:["Registered Family Members (",m.length,")"]}),(0,s.jsxs)("p",{className:"text-xs text-gray-400",children:["Pulled live from Supabase table ",(0,s.jsx)("code",{children:"family_members"}),"."]})]}),(0,s.jsx)("button",{onClick:F,disabled:p,className:"border rounded-lg px-4 py-1.5 text-sm hover:bg-gray-50 disabled:opacity-60",children:p?"Refreshing...":"Refresh"})]}),(0,s.jsx)("div",{className:"overflow-x-auto rounded-lg border",children:(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{className:"text-left",children:[(0,s.jsx)("th",{className:"py-2.5 px-3",children:"Name"}),(0,s.jsx)("th",{className:"py-2.5 px-3",children:"Role"}),(0,s.jsx)("th",{className:"py-2.5 px-3",children:"Location"}),(0,s.jsx)("th",{className:"py-2.5 px-3",children:"Phone"}),(0,s.jsx)("th",{className:"py-2.5 px-3",children:"Joined"})]})}),(0,s.jsx)("tbody",{children:j?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:5,className:"py-4 px-3 text-red-500",children:j})}):p?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:5,className:"py-4 px-3 text-gray-500",children:"Loading..."})}):0===m.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:5,className:"py-4 px-3 text-gray-400",children:"No members in Supabase yet."})}):m.map(e=>(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsx)("td",{className:"py-2.5 px-3",children:e.full_name||"—"}),(0,s.jsx)("td",{className:"py-2.5 px-3",children:e.role||"Member"}),(0,s.jsx)("td",{className:"py-2.5 px-3",children:e.location||"—"}),(0,s.jsx)("td",{className:"py-2.5 px-3",children:e.phone||"—"}),(0,s.jsx)("td",{className:"py-2.5 px-3 text-xs text-gray-500",children:e.joined_at?new Date(e.joined_at).toLocaleDateString():e.created_at?new Date(e.created_at).toLocaleDateString():"—"})]},e.id))})]})}),(0,s.jsxs)("p",{className:"text-xs text-gray-400 mt-3",children:["Edit / correct entries in Supabase → Table editor →"," ",(0,s.jsx)("code",{children:"family_members"}),"."]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-5 mt-5 flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold flex items-center gap-2",children:(0,s.jsx)("span",{children:"👪 Family Members"})}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Pulled from Supabase table ",(0,s.jsx)("code",{children:"family_members"}),"."]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-3xl font-bold text-green-700",children:m.length}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Total registered"})]})]})]})]})})}},81135,e=>{e.v(e=>Promise.resolve().then(()=>e(53594)))}]);